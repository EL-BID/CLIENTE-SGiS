<!-- crud asignar url de la api URL="url de la api" titulo="un titulo para la pestaña de la pagina" [dato]="variable que contiene el formulario]-->
<listar #ctrl URL="incidencias?edo_incidencia={{edo_incidencia}}" titulo="Incidencias / Transacciones" ></listar>

<!-- Menu principal "-->
<sistema-menu></sistema-menu>

<div class="contenedor columns " style="height:100%; ">
    <div class="column is-2 is-hidden-mobile menu-izquierda">

        <!-- Menu izquierda del modulo enviroment" -->
        <sistema-menu-aside ></sistema-menu-aside>
    </div>
    <div class="column" style="padding:0.5em;">
        <div style="background: #FFF; border-radius: 1em; ">
            
            <!-- Opciones y busqueda -->
            <section class="hero" [ngClass]=" {'is-dark': ctrl.busquedaActivada, 'is-primary': !ctrl.busquedaActivada } ">
                <div class="hero-body">
                    <nav class="level ">
                        <!-- Left side -->
                        <div class="level-left ">
                            <div class="level-item">
                                <p class="title">
                                    <span class="icon is-medium">
                                        <i class="{{icono}}"></i>
                                    </span> {{modulo_actual}}
                                </p>
                            </div>                
                        </div>
            
                        <!-- Right side -->
                        <div class="level-right ">
                            <div class="level-item">
                                <div class="field">
                                    <label>Buscar por Paciente:</label>
                                    <div class="control has-icons-left is-expanded">
                                        <input type="text" class="input is-flat is-medium" placeholder="Buscar" #searchBox id="search-box" (keyup)="ctrl.buscar(searchBox.value)">
                                        <span class="icon is-medium is-left">
                                            <i class="fa fa-search"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="level-item" *ngIf="ctrl.dato.estados_incidencias != ''">
                                <a (click)="ctrl.mostrarLista(1)" id="rebuscar"></a>
                                <div class="control is-expanded" *ngIf="!ctrl.cargando && ctrl.dato && !ctrl.busquedaActivada" >
                                    <div class="field">
                                        <label>Filtrar por Estado de Incidencia:</label>
                                        <div class="select is-medium" >
                                            <select class="select is-medium" [(ngModel)]="edo_incidencia" #searchBox id="search-box" (change)="cambiar_busqueda()">
                                                <option  value="">Todos</option>
                                                <option *ngFor="let val of ctrl.dato[ctrl.dato.length-1].estados_incidencias" value="{{val.id}}"  >{{ val.nombre }}</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            <a class="navbar-item tooltip" (click)="ctrl.listar(1)" id="cargar_datos_actualizar" *ngIf="!ctrl.busquedaActivada">
                                <span class="icon fa-2x">
                                    <i class="fa fa-refresh"></i>
                                </span>
                                <span class="tooltiptext">Actualizar</span>
                            </a>
            
                            <a class="navbar-item tooltip" (click)="ctrl.listarBusqueda(searchBox.value,1)" id="cargar_datos_actualizar" *ngIf="ctrl.busquedaActivada">
                                <span class="icon fa-2x">
                                    <i class="fa fa-refresh"></i>
                                </span>
                                <span class="tooltiptext">Actualizar</span>
                            </a>
            
                            <a class="navbar-item tooltip" routerLink="{{url_nuevo}}" *ngIf="permisos.indexOf(controlador + '.store') > -1 || permisos.indexOf( 'Sis' + controlador + '.store') > -1">
                                <span class="icon fa-2x">
                                    <i class="fa fa-file"></i>
                                </span>
                                <span class="tooltiptext">Nuevo</span>
                            </a>
            
            
                            <a class="navbar-item  is-dark tooltip" *ngIf="ctrl.busquedaActivada" (click)="ctrl.cerrar_busqueda(searchBox)">
                                <span class="icon fa-2x">
                                    <i class="fa fa-close"></i>
                                </span>
                                <span class="tooltiptext">Cerrar Busqueda</span>
                            </a>
                        </div>
                    </nav>
                </div>
            </section>
                
                <div class="is-fullwidth has-text-centered" *ngIf="ctrl.cargando">
                    <br>
                    <span class="tag is-primary is-large "><span class="icon"><i class="fa fa-refresh fa-spin"></i></span> &nbsp;<span>Cargando...</span></span>
                    <br>
                    <br>
                </div>


            <span style="overflow-y:auto; overflow-x:hidden; display:block" [style.maxHeight.px]="tamano-285">

                    <span *ngIf="ctrl.tipo_grid && !ctrl.cargando ">
                            <div class="box" *ngFor="let item of ctrl.dato; let i=index" style="margin-bottom:0.1rem;" [style.background]="i%2 == 0 ? '#fafafa' : '#ffffff'">
                                <article *ngIf="(i+1)<ctrl.dato.length" class="media">

                                    <div *ngIf="(i+1)<ctrl.dato.length" class="media-left is-medium">
                                        <figure class="image is-64x64">
                                            <img src="../assets/iconos/persona.jpg">
                                        </figure>
                                    </div>
                                    <div *ngIf="(i+1)<ctrl.dato.length" class="media-content" >
                                        <div class="content" *ngIf="(i+1)<ctrl.dato.length">
                                        <p *ngIf="(i+1)<ctrl.dato.length">

                                            <a *ngIf="(i+1)<ctrl.dato.length" title="Paciente">
                                                <div *ngFor="let val of item.pacientes" class="is-medium fa-2x">
                                                    <strong>{{ val.personas.nombre }} {{ val.personas.paterno }} {{ val.personas.materno }}</strong>
                                                </div>
                                            </a>
                                            <a *ngIf="(i+1)<ctrl.dato.length"  title="N° Folio">
                                                    <strong>{{item.id}}</strong>
                                            </a>
                                            <br>
                                            <a *ngIf="(i+1)<ctrl.dato.length"  title="Antigüedad">
                                                <small>
                                                    <i class="fa fa-clock-o"></i>
                                                    <strong>{{ item.antiguedad }}</strong>
                                                </small>
                                            </a>
                                            <br>
                                            <a *ngIf="(i+1)<ctrl.dato.length" class="tag is-medium fa-2x" [ngClass]="{'is-success' : item.movimientos_incidencias[0].triage_colores.nombre == 'Verde', 'is-warning' : item.movimientos_incidencias[0].triage_colores.nombre == 'Amarillo', 'is-danger' : item.movimientos_incidencias[0].triage_colores.nombre == 'Rojo'}" title="Triage">
                                            
                                                <strong>{{ item.movimientos_incidencias[0].triage_colores.nombre }}</strong>
        
                                            </a>
                                        </p>
                                        </div> 
                                        <nav *ngIf="(i+1)<ctrl.dato.length" class="level is-mobile" style="float:right">

                                        <div *ngIf="(i+1)<ctrl.dato.length" class="level-left" >

                                            <a class="navbar-item tooltip" (click)="download($event, item.id);">
                                                    <span class="icon fa-2x  has-text-danger ">
                                                        <i class="fa fa-file-pdf-o"></i>
                                                    </span>
                                                    <span class="tooltiptext">PDF</span>
                                            </a>

                                            <a class="navbar-item tooltip" routerLink="/transacciones/seguimiento/editar/{{item.id}}">
                                                <span class="icon fa-2x has-text-info">
                                                        <i class="fa fa-exchange"></i>
                                                </span>
                                                <span class="tooltiptext">Seguimiento</span>
                                            </a>
                                            

                                            <tabla-acciones [item]="item" [index]="i" [ctrl]="ctrl" class="level-left"></tabla-acciones>

                                        </div>

                                        </nav>           
                                    </div>
                                </article>
                            </div>
                        </span>


                <!--Lista -->
   
            </span>
            <!-- Paginación para la lista  -->
            <paginacion [ctrl]="ctrl"></paginacion>

        </div>
    </div>
</div>

<!-- <div class="modal" id="confirmarPDF">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
            <p class="modal-card-title"><i class="fa fa-warning"></i> Alerta</p>
            <button class="delete" (click)="cancelarModal('confirmarPDF')"></button>
            </header>
            <section class="modal-card-body">
                <div class="content">
                    <h1>¿Desea generar el Archivo PDF?</h1>
                    <p>Se guardara el archivo PDF en su Computadora</p>
                </div>
            </section>
            <footer class="modal-card-foot">
            <a class="button is-success" (click)="download($event, item.id)" >Continuar</a>
            <a class="button" (click)="cancelarModal('confirmarPDF')">Cancelar</a>
            </footer>
        </div>
</div> -->